# Chapter 4. 프로그램의 구조



# 💗 문제

## 1. 시스템콜이 이루어지는 과정을 설명해주세요



## 2. 명령의 종류에 대해 설명하고 각각의 역할이 무엇인지 설명해주세요.



## 3. 사용자 프로그램이 특권명령을 수행해야할 경우에는 어떻게 동작하는지 설명해주세요.



# 💗 요약

## 1. 프로그램의 구조와 인터럽트



프로그램의 구조로는

1. 코드 - 프로그래머가 작성한 코드를 기계어 명령 형태로 저장해 놓음

2. 데이터 - 프로그램이 사용하는 데이터를 저장함

3. 스택 - 호출된 함수의 수행을 마치고 복귀할 주소에 관한 데이터를 임시로 저장함

   ⋇ 인터럽트도 스택의 원리를 사용하지만 인터럽트에서 사용할 위치 정보(다시 돌아가기 위한)는 운영체제의 프로세스 제어 블록(Process Control Block)에 저장된다.



이러한 구조는 각 사용자 프로그램마다 있는 것은 물론  운영체제에도 있는데 이 구조들이 있는 주소 공간을 가상 메모리 혹은 논리 메모리라고 따로 부른다.



## 2. 컴퓨터 시스템의 작동 개요



컴퓨터 시스템을 실질적으로 작동시키는 것은 CPU이다.

이 **CPU는 연산작업만을 할 뿐 어떤 것을 먼저 처리할 지에 대해서는 고민하지 않고 프로그램 카운터(PC, 운영체제의 소프트웨어)가 정하며 이에 따라 실행된다. **



## 3. 프로그램의 실행



프로그램이 실행된다는 의미는 크게 두가지로 나뉜다.

1. 디스크(HDD, SSD)에 존재하던 실행 파일이 메모리(RAM)에 적재된다. 이 때 메모리의 사용 효율을 위해 다 올리지 않고 나눠서 올린다.

2. 프로그램이 CPU를 할당받고 명령을 수행한다.

   

CPU가 실행해야할 프로그램은 메모리(RAM)에 올라간 후.

메모리에서 프로그램 카운터의 지시에 따라 **CPU가 어떤 프로그램을 처리하고 있느냐에 따라 커널 모드(OS 프로그램)와 사용자 모드(사용자 프로그램)**로 나뉜다.  

이 때 프로그램이 CPU에게 명령을 내린다고 표현하는데,

**이 명령은 일반 명령(모든 프로그램이 할 수 있는 명령)과 특권 명령(보안이 필요한 명령, 하드웨어에 직접적으로 관련되는 명령)**으로 나뉘며 모드 비트로 제어한다.





## 4. 사용자 프로그램이 사용하는 함수



프로그램은 결국 함수의 집합이라고 할 수 있으며 **사용자 프로그램이 사용하는 함수는 3가지**가 있다.

1. 사용자 정의 함수

   사용자가 직접 작성한 함수

   

2. 라이브러리 함수

   사용자가 직접 작성하지는 않았지만 누군가 작성하여 사용하게된 함수

   

3. 커널 함수

   운영체제 커널에 정의된 함수



## 5. 인터럽트



인터럽트는 CPU를 뺏어오기 위한 것으로 인터럽트의 종류에 따라 중요도가 나뉘어져 있다. 

인터럽트 중에 인터럽트를 실행하는 것은 원칙적으로는 막혀있다. 그 이유는 인터럽트가 실행되던 중에 다른 인터럽트가 실행되면 데이터의 일관성이 깨지기 때문이다. 하지만 새롭게 들어온 인터럽트의 중요도가 더 높을 경우에는 가능하다.



## 6. 시스템 콜



시스템 콜이란 사용자 프로그램이 특권명령을 수행해야할 경우 사용자 프로그램이 직접 명령을 내릴 수 없기 때문에 OS에게 요청하는 것을 의미한다.



## 7. 프로세스의 두 가지 실행 상태



어떠한 사용자 프로그램이 실행 되는 것은 **사용자 모드에서의 실행 상태**라고 하며 시스템 콜이 들어와서 커널에서 실행될 경우 **커널 모드에서의 실행 상태**라고 한다. 하지만 이것은 사용자 프로그램이 실행 상태에 있다고 얘기 하며 커널이 실행 상태에 있다고는 이야기 하지 않는다. 

