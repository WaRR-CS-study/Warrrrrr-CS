## 6장 CPU 스케줄링



#### CPU

- 기계어 명령을 실제로 수행하는 컴퓨터 내의 중앙 처리장치

- 한 시스템에 한 개로 시분할 환경에서 효율적으로 관리되어야 하는 자원

- **CPU의 기계어 명령**

  - CPU내에서 수행되는 명령

    매우 빠름

    ex) Add

  - 메모리 접근을 필요로 하는 명령

    비교적 빠름

    ex) Load, Store

  - 입출력을 동반하는 명령

    오래 걸림

  ##### 사용자 프로그램 수행

  - CPU 작업과 I/O 작업의 반복

  - CPU를 직접 가지고 수행하는 일련의 단계 **CPU버스트**

  - I/O 요청이 발생해 커널에 의해 입출력 작업을 진행하는 단계 **I/O버스트**

  - CPU버스트가 빈번하면 **CPU 바운드 프로세스** 

    ex) 계산 위주의 프로그램

  - I/O버스트가 빈번하면 **I/O 바운드 프로세스**

    ex) 대화형 프로그램

- **CPU 스케줄링**은 CPU를 사용하는 패턴이 상이한 여러 프로그램이 동일한 시스템에서 사용되기 때문에 필요

- **CPU 버스트**가 짧은 프로세스는 대부분 **대화형 작업**이므로 우선적으로 CPU를 사용하도록 스케줄링 해야한다.

  = **I/O 바운드 프로세스**의 우선순위를 높인다.



#### CPU 스케줄러

- 준비 상태에 있는 프로세스들 중 어떠한 프로세스에게 CPU를 할당할지 결정하는 운영체제 코드

- **CPU 스케줄러가 호출되는 경우**

  - 1) 프로세스가 봉쇄상태로 바뀌는 경우
  - 2) 프로세스가 타이머 인터럽트 발생으로 준비상태로 바뀌는 경우
  - 3) 봉쇄상태의 프로세스가 I/O 작업을 완료하여 준비상태로 바뀌는 경우
  - 4) 실행중이던 프로세스가 종료되는 경우

- **CPU 스케줄링 방식**

  - **비선점형** 1), 4)

    CPU를 획득한 프로세스가 스스로 반납하기 전까지 빼앗지 않는 방법

  - **선점형** 2), 3)

    CPU를 강제로 빼앗을 수 있는 방법

    

#### 디스패처

- 선택된 프로세스에게 CPU 할당 시 작업을 수행할 수 있도록 환경설정을 하는 운영체제의 코드
  - 수행중이던 프로세스 문맥 PCB 저장
  - 선택된 프로세스 PCB로부터 복원
  - CPU 넘김



#### 스케줄링의 성능 평가

- **시스템 관점의 지표**
  - CPU 이용률
  - 처리량
- **사용자 관점의 지표**
  - 소요시간
  - 대기시간
  - 응답시간



#### 스케줄링 알고리즘

- **선입선출 스케줄링**

  - **콘보이 현상**

    CPU 버스트가 짧은 프로세스가 CPU 버스트가 긴 프로세스보다 나중에 도착해 오랜 시간을 기다려야 하는 현상

    

- **최단작업 우선 스케줄링**

  - CPU 버스트가 가장 짧은 프로세스에게 제일 먼저 CPU를 할당하는 방식

  - 평균 대기시간을 가장 짧게 하는 알고리즘

  - 비선점형

  - 선점형

    남은 CPU 버스트보다 CPU 버스트가 더 짧은 프로세스가 도착할 경우 CPU 이양

    - **기아 현상**

      연속된 CPU 버스트가 짧은 프로세스의 등장으로 CPU를 할당받지 못하는 현상

      

- **우선순위 스케줄링**

  - 우선순위 값이 낮은 순서로 스케줄링

  - 우선순위를 결정하는 방식에는 여러가지가 있다.

  - 비선점형 / 선점형

  - **우선순위 기아현상**

    - 노화 기법으로 해결

      기다리는 시간이 길어지면 우선순위를 조금씩 높이는 기법

      

- **라운드 로빈 스케줄링**

  - 할당시간을 지정하고 그 시간이 지나면 준비 큐의 맨 뒤로 보내는 방법
  - 할당시간이 너무 길면 선입선출과 같은 문제점이 드러남 (**콘보이 현상**)
  - 할당시간이 너무 짧으면 빈번한 프로세스 교체로 문맥교환의 오버헤드가 커짐



- **멀티레벨 큐**

  - 준비 큐를 여러 개로 분할해 관리하는 기법

  - 대화형 작업을 담기 위한 **전위 큐**

  - 계산 위주의 작업을 위한 **후위 큐**

  - 고정 우선순위 방식

    전위 큐가 우선적으로 CPU가 할당되고 전위 큐가 비게되면 후위 큐에 할당하는 방식

  - 타임 슬라이스 방식

    각 큐에 대한 CPU 시간을 적절한 비율로 할당



- **멀티레벨 피드백 큐**

  - 멀티레벨 큐와 동일하지만, 큐에서 다른 큐로 이동이 가능

    ex) 우선순위가 낮은 큐에서 오래 기다렸으면 우선순위가 높은 큐로 승격

  - **멀티레벨 피드백 큐 정의요소**

    - 큐의 수
    - 각 큐의 스케줄링 알고리즘
    - 프로세스를 상위 큐로 승격시키는 기준
    - 프로세스를 하위 큐로 강등시키는 기준
    - 새로운 프로세스가 어느 큐에 들어갈지 결정하는 기준



- **다중처리기 스케줄링**

  - **다중처리기 시스템**이란 CPU가 여러개인 시스템

  - 준비 큐에서 CPU가 알아서 프로세스를 꺼내가는 방식

  - **큐가 여러개인 경우**

    - 일부 CPU에 작업이 편중될 수 있으므로 **부하균형 메커니즘**이 필요

    - **대칭형 다중처리**

      CPU가 각자 알아서 스케줄링

    - **비대칭형 다중처리**

      하나의 CPU가 모든 CPU의 스케줄링 및 데이터 접근을 책임지고 정함



- **실시간 스케줄링**

  - 주어진 데드라인 안에 작업을 처리해야하는 실시간 시스템을 스케줄링

  - 데으라인이 얼마 남지 않은 요청을 먼저 처리

  - **경성 실시간 시스템**

    반드시 정해진 시간 안에 작업을 완료

    ex) 미사일 발사, 원자로 제어 등

  - **연성 실시간 시스템**

    데드라인이 존재는 하지만 유연하게 대처

    ex) 멀티미디어 스트리밍 시스템



#### 스케줄링 알고리즘의 평가

- **큐잉모델**

  확률분포를 통해 프로세스의 도착률과 CPU의 처리율을 입력값으로 주고, CPU 처리량, 프로세스 평균 대기시간 평가

- **시뮬레이션**

  가상의 스케줄링 프로그램 작성 후 결과를 평가

- **구현 및 실측**

  스케줄링 코드를 수정하고 이전의 코드와 비교하여 평가